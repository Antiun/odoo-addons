<?xml version="1.0" encoding="utf-8"?>
<openerp>
	<data>
	
		<!-- Views -->
	    <record model="ir.ui.view" id="view_account_periodical_invocing_agreement_line_tree">
	        <field name="name">account.periodical_invoicing.agreement.line.tree</field>
	        <field name="model">account.periodical_invoicing.agreement.line</field>
	        <field name="type">tree</field>
	        <field name="priority" eval="6"/>
	        <field name="arch" type="xml">
	            <tree string="Agreement lines">
					<field name="active_chk"/>
	                <field name="product_id"/>
					<field name="name"/>
					<field name="quantity"/>
	                <field name="price"/>
					<field name="discount"/>
	                <field name="invoicing_interval"/>
	                <field name="invoicing_unit"/>
					<field name="last_invoice_date" readonly="True"/>
					<field name="notes"/>
	            </tree>
	        </field>
		</record>

	    <record model="ir.ui.view" id="view_account_periodical_invocing_agreement_line_form">
	        <field name="name">account.periodical_invoicing.agreement.line.form</field>
	        <field name="model">account.periodical_invoicing.agreement.line</field>
	        <field name="type">form</field>
	        <field name="priority" eval="6"/>
	        <field name="arch" type="xml">
	            <form string="Agreement line">
	                <group colspan="3" col="2">
	                    <field name="product_id" on_change="onchange_product_id(product_id)"/>
					</group>
					<group colspan="1" col="2">
						<field name="active_chk"/>
					</group>
	                <group colspan="4" col="2">
						<field name="name"/>
					</group>
	                <group colspan="4" col="6">
						<field name="quantity"/>
						<field name="price"/>
						<field name="discount"/>
					</group>
	                <field name="invoicing_interval"/>
	                <field name="invoicing_unit"/>
	                <group colspan="4" col="2">
						<field name="notes"/>
					</group>
	            </form>
	        </field>
		</record>

	    <record model="ir.ui.view" id="view_account_periodical_invocing_agreement_invoice_tree">
	        <field name="name">account.periodical_invoicing.agreement.invoice.tree</field>
	        <field name="model">account.periodical_invoicing.agreement.invoice</field>
	        <field name="type">tree</field>
	        <field name="priority" eval="6"/>
	        <field name="arch" type="xml">
	            <tree string="Agreement invoices">
					<field name="date"/>
					<button name="view_invoice" string="View invoice" type="object" icon="terp-gtk-go-back-rtl"/>
	                <field name="invoice_id"/>
	            </tree>
	        </field>
		</record>

	    <record model="ir.ui.view" id="view_account_periodical_invocing_agreement_renewal_tree">
	        <field name="name">account.periodical_invoicing.agreement.renewal.tree</field>
	        <field name="model">account.periodical_invoicing.agreement.renewal</field>
	        <field name="type">tree</field>
	        <field name="priority" eval="6"/>
	        <field name="arch" type="xml">
	            <tree string="Agreement renewals">
					<field name="date"/>
	                <field name="comments"/>
	            </tree>
	        </field>
		</record>

	    <record model="ir.ui.view" id="view_account_periodical_invocing_agreement_tree">
	        <field name="name">account.periodical_invoicing.agreement.tree</field>
	        <field name="model">account.periodical_invoicing.agreement</field>
	        <field name="type">tree</field>
	        <field name="priority" eval="6"/>
	        <field name="arch" type="xml">
	            <tree string="Agreements">
	                <field name="number"/>
	                <field name="name"/>
	                <field name="partner_id"/>
	                <field name="start_date"/>
	                <field name="next_expiration_date"/>
	                <field name="company_id"/>
	            </tree>
	        </field>
	    </record>

		<record model="ir.ui.view" id="view_account_periodical_invocing_agreement_form">
			<field name="name">account.periodical_invoicing.agreement.form</field>
			<field name="model">account.periodical_invoicing.agreement</field>
			<field name="type">form</field>
			<field name="priority" eval="6"/>
			<field name="arch" type="xml">
				<form string="Agreement">
	                <group colspan="3" col="2">
	                    <field name="name"/>
					</group>
					<group colspan="1" col="4">
						<field name="number"/>
						<field name="active"/>
					</group>
					<field name="partner_id"/>
					<field name="company_id"/>
					<group colspan="4" col="8">	
						<field name="start_date" on_change="onchange_start_date(start_date)" attrs="{'readonly':[('state','!=','empty')]}"/>
						<field name="period_type"/>
						<field name="prolong" attrs="{'readonly':[('renewal_state','!=','not_renewed')]}"/>
					</group>
					<group colspan="4" col="8">	
						<group attrs="{'invisible': [('prolong','!=', 'fixed')]}" colspan="4" col="2"> 
							<field name="end_date" attrs="{'required': [('prolong', '=', 'fixed')]}"/>
						</group>
						<group attrs="{'invisible': [('prolong','=', 'fixed')]}" colspan="4" col="4">
							<field name="prolong_interval" attrs="{'required': [('prolong', '!=', 'fixed')]}"/>
							<field name="prolong_unit" attrs="{'required': [('prolong', '!=', 'fixed')]}"/>
						</group>
					</group>
					<notebook colspan="4">
						<page string="Lines">
							<field colspan="4" mode="tree" name="agreement_line" widget="one2many_list" nolabel="1"/>
						</page>
						<page string="Invoices">
							<field colspan="4" mode="tree" name="invoice_line" widget="one2many_list" nolabel="1"/>
						</page>
						<page string="Renewals" attrs="{'invisible': [('prolong','!=', 'recurrent')]}">
							<field colspan="4" mode="tree" name="renewal_line" widget="one2many_list" nolabel="1"/>
						</page>
						<page string="Notes">
							<field colspan="4" name="notes" nolabel="1"/>
						</page>
					</notebook>
					<group colspan="4" col="8">
						<field name="last_renovation_date" readonly="1"/>
						<field name="next_expiration_date"/>
						<button name="make_initial_invoice" string="Make initial invoice" type="object" icon="gtk-execute" attrs="{'invisible': ['|', ('period_type','=', 'post-paid'), ('state','!=','empty')]}"/>
	                    <button name="%(action_account_periodical_invoicing_renew_wizard)d" type="action" string="Renew agreement"  attrs="{'invisible': [('prolong','!=', 'recurrent')]}"/>
						<field name="state" invisible="1"/>
						<field name="renewal_state" invisible="1"/>
					</group>
				</form>
			</field>
		</record>
		
		<!-- Windows actions -->
		
		<record model="ir.actions.act_window" id="action_account_periodical_invoicing_agreement">
			<field name="name">Agreements</field>
			<field name="res_model">account.periodical_invoicing.agreement</field>
			<field name="view_type">form</field>
			<field name="view_mode">tree,form</field>
			<field name="help">Agreements are the way you define the commercial relation with your customers which specify certain products/services that you are providing them that requires a periodical invoice.</field>
		</record>
	
		<!-- Windows actions views -->
	
		<record model="ir.actions.act_window.view" id="action_account_periodical_invoicing_agreement_view_tree">
			<field name="sequence" eval="1"/>
			<field name="view_mode">tree</field>
			<field name="view_id" ref="view_account_periodical_invocing_agreement_tree"/>
			<field name="act_window_id" ref="action_account_periodical_invoicing_agreement"/>
		</record>
	
		<record model="ir.actions.act_window.view" id="action_account_periodical_invoicing_agreement_view_form">
			<field name="sequence" eval="2"/>
			<field name="view_mode">form</field>
			<field name="view_id" ref="view_account_periodical_invocing_agreement_form"/>
			<field name="act_window_id" ref="action_account_periodical_invoicing_agreement"/>
		</record>
		
		<!-- Menu items -->
		
		<menuitem name="Periodical invoicing" parent="account.menu_finance_periodical_processing" id="menu_periodicalinvoicing"/>
		<menuitem name="Agreements" id="menu_periodicalinvoicing_agreements" parent="menu_periodicalinvoicing" action="action_account_periodical_invoicing_agreement"/>
	  
	</data>
</openerp>
